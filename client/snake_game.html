<!--
Created for Milestone 1

Group 12

Jonathan Mayer 66268081
Brian Lam 62101239
Yu Koizumi 
Tommy Wong 71659011
-->
<!doctype html>
<html>
<head>
	<meta charset='UTF-8' />
	<style>
		input, textarea {border:1px solid #CCC;margin:0px;padding:0px}

        #ip {line-height:20px}
        #port {line-height:20px}
		#body {max-width:800px;margin:auto}
		#log {width:100%;height:50px}
        #user1 {line-height:20px}
        #user2 {line-height:20px}
	</style>
	<link rel='stylesheet' type='text/css' href='stylesheet.css'/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="fancywebsocket.js"></script>
	<script>
		var Server;

		function log( text ) {
			$log = $('#log');
			//Add text to log
			$log.append(($log.val()?"\n":'')+text);
			//Autoscroll
			$log[0].scrollTop = $log[0].scrollHeight - $log[0].clientHeight;
		}

        function connect(){
            log('Connecting...');
			Server = new FancyWebSocket('ws://' + document.getElementById('ip').value + ':' + document.getElementById('port').value);

			//Let the user know we're connected
			Server.bind('open', function() {
                document.getElementById("cntBtn").disabled = true;
				log( "Connected." );
				document.getElementById("userSendButton").disabled = false;
			});

			//OH NOES! Disconnection occurred.
			Server.bind('close', function( data ) {
                document.getElementById("cntBtn").disabled = false;
				log( "Disconnected." );
				document.getElementById("userSendButton").disabled = true;
				document.getElementById("startgame").disabled = true;
			});

			//Log any messages sent from server
			Server.bind('message', function( payload ) {
				log( payload );
			});

			Server.connect();
        }

	</script>
        <canvas id="a" width="500" height="500">
            This text is displayed if your browser does not support HTML5 Canvas.
        </canvas>
	<script type='text/javascript' src='script.js'></script>
	<script>
		function start()
		{
			document.getElementById("startgame").disabled = true;
			reset();
			Server.send('start_game', "/start_game-" + "??");
			mainLoop();
		}
		function mainLoop()
		{
			snakeList = updateSnakes(snakeList, board);
    		var score = getWinner(snakeList, canvas);
    		if (score == null) {
     		    drawSnakes(snakeList, canvas);
        		drawFood(board, canvas);
        		Server.send('score', "/score-" + document.getElementById("user1").value + "-" + snakeList[0].length);
        		Server.send('score', "/score-" + document.getElementById("user2").value + "-" + snakeList[1].length);
    			setTimeout(mainLoop, 50);// , snakeList, canvas, board
		  	} else {
        		Server.send('score', "/score-" + document.getElementById("user1").value + "-" +snakeList[0].length);
        		Server.send('score', "/score-" + document.getElementById("user2").value + "-" +snakeList[1].length);

				document.getElementById("userSendButton").disabled=false;
		  	}
		}
		function setUsernames()
		{
			document.getElementById("userSendButton").disabled=true;
			document.getElementById("startgame").disabled = false;
		}
	</script>

</head>

<body>
	<div id='body'>
        Server ip: <input type='text' id='ip' name='ip'>
        Server port: <input type='text' id='port' name='port'>
        <button type="button" id='cntBtn' onclick="connect();">Connect</button>
		<textarea id='log' name='log' readonly='readonly'></textarea><br/>
        Username 1: <input type='text' id='user1' name='user1' value="Player 1">
        Username 2: <input type='text' id='user2' name='user2' value="Player 2">
        <button type="button" id='userSendButton' disabled=true onclick="setUsernames();">Set Usernames</button>
        <button type="button" id='startgame' disabled=true onclick="start();">Start Game</button>
	</div>
</body>

</html>
